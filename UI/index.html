<HTML> 
	<HEAD>
		<script src="/socket.io/socket.io.js"></script>
		<SCRIPT type="text/javascript">
		 var socket = io.connect('http://localhost:8080');
		 socket.on('connect', function (data) {
			//alert('client is connected');
		  });
		  
		  socket.on('playerListUpdate', function (data) {
			//alert('playerListUpdate');
			drawNames(data);
		  });
		<!--All script in this tag is run when the page loads-->
		//alert("Welcome to the batcave!");
		
		//store global variable
		var namesArray;
		var trackLength = 8;
		
		//define object 
		
		function init()
		{
			document.getElementById('init').hidden=false;
			document.getElementById('game').hidden=true;
			document.getElementById('results').hidden=true;
			namesArray = {};
			namesList.innerHTML = "";
		}
		
		function receiveData(gameObject)
		{
			//gameObject = JSON.parse(gameObject);
			//Writes game object to page
			var winner = -1;
			for (var i = 0; i<Object.keys(namesArray).length; i++)
			{
				namesArray[Object.keys(namesArray)[i]] = gameObject[Object.keys(namesArray)[i]];
				if (namesArray[Object.keys(namesArray)[i]] == trackLength-1)
					winner=i;
			}
			drawNames();
			renderBoard();
			if (winner != -1)
				showResults(winner);
		}
		function fakeData()
		{
			var data = {};
			for (var i = 0; i<Object.keys(namesArray).length; i++)
				data[Object.keys(namesArray)[i]] = namesArray[Object.keys(namesArray)[i]];
			var rnd = Math.floor(Math.random()*Object.keys(namesArray).length);
			data[Object.keys(data)[rnd]]++;
			receiveData(JSON.stringify(data));
		}
		
		function renderBoard()
		{
		   
			var grid = document.getElementById('gameBoard');
			grid.innerHTML = "";
			
			//now construct our table
			//for now hardcode it to be 8 rows and n columns
				// Object.keys(namesArray).length is n
			//horse position determined by 8-m where m is value associated with player
			          	 
		   			   
			for (var i = 0; i < 8; i++)
				grid.innerHTML += "<col width= '30px'>";
			grid.innerHTML += "<tbody id='tableBody'></tbody>";
			var gridTest = document.getElementById("tableBody");
			var html = "";
			
			html += "<tr><td colspan='" + Object.keys(namesArray).length + "'>";
			for( var k = 0; k < Object.keys(namesArray).length ; k++)
				html += "------";
			html += "</td></tr>";
			
			gridTest.innerHTML += html;  
			for (var i = 0; i < 8; i++)
			{
				gridTest.innerHTML += "<tr>";
				html = "";
				for (var j = 0; j < Object.keys(namesArray).length; j++)
				{
					html += "<td>";
					if (namesArray[Object.keys(namesArray)[j]] == 7-i)
						html +=  "|  " + (j+1) + "|" ;
					else
						html += "| . |";
					html += "</td>";
				}
				gridTest.innerHTML += html + "</tr>";
			}
			
			html += "<tr><td colspan='" + Object.keys(namesArray).length + "'>";
			for( var k = 0; k < Object.keys(namesArray).length ; k++)
				html += "------";
			html += "</td></tr>";
			gridTest.innerHTML += html; 
				
	          
			return;
		}
		
		function showBorder()
		{
		var bar = document.getElementById('gameborder');
		
			
		
		
		}
		
		function addName ()
		{
		
			var name = document.getElementById('nameInputBox');
			//TODO: SEND LIST OF NAMES TO SERVER
			//JSON.stringify(namesArray);
			socket.emit('join',name.value);
			
			if (Object.keys(namesArray).length>=6)
			{
				alert("Sorry, this game has a max of 6 players.");
			}
			else if (namesArray[name.value] == 0)
			{
				alert("Sorry, no duplicate names allowed");
			}
			else
			{
				namesArray[name.value]=0;
				name.value = "";
				drawNames();
			}
			
			
		}
		
		function drawNames(inputNamesArray)
		{
			if (inputNamesArray)
			{
				namesArray = inputNamesArray;
			}
			var namesList = document.getElementById('namesList');
			namesList.innerHTML = "";
			for (var i = 0; i<Object.keys(namesArray).length; i++)
				namesList.innerHTML += "<li>" + Object.keys(namesArray)[i] + "</li>";	
			
		}
		
		function startGame()
		{
			if (Object.keys(namesArray).length <=1)
			{
				alert("Need at least two players to play!");
				exit;
			}
			document.getElementById('init').hidden=true;
			document.getElementById('game').hidden=false;
			
			socket.emit('startGame',name.value);
			
			//renderBoard();
			
			//send list of all player objects to server
			//alert(JSON.stringify(namesArray));
			
		}
		
		function showResults(winnerVal)
		{
			document.getElementById('game').hidden=true;
			document.getElementById('results').hidden=false;
			document.getElementById('winner').innerHTML = "Winner was: " + Object.keys(namesArray)[winnerVal];
		}
		
		</SCRIPT>
	</HEAD>
	<BODY>
		<div id="init">
			Enter your Name: <input type="text" id='nameInputBox' onkeydown="if (event.keyCode == 13) addName()" />
			<br />
				<input type="button" value ="Add Name" onclick="addName()"/>
			<br/>
			Players:
			<br />
			<ol id="namesList"> 
			</ol>
			<br />
			<input type="button" value="Start Game" onclick="startGame()"/>
		</ul>
		</div>
		<div id="game">
			start game
			<br />
			<table id="gameBoard" border="0">
			</table>
			<br />
			<input type="button" value="increment" onclick="fakeData()"/>
		</div>
		<div id="results">
			show results
			<br />
			<p id="winner"></p>
			<input type="button" value="New Game" onclick="init()"/>
		</div>
		
		<!-- quick script call to init -->
		<script type="text/javascript">init();</script>
	</BODY>
</HTML>