<HTML> 
	<HEAD>
		<link rel="stylesheet" type="text/css" href="style.css">
		<SCRIPT type="text/javascript">
		<!--All script in this tag is run when the page loads-->
		//alert("Welcome to the batcave!");
		
		//store global variable
		var namesArray;
		var trackLength = 8;
		
		//define object 
		
		function init()
		{
			document.getElementById('init').hidden=false;
			document.getElementById('game').hidden=true;
			document.getElementById('results').hidden=true;
			namesArray = {};
			namesList.innerHTML = "";
		}
		
		function receiveData(gameObject)
		{
			gameObject = JSON.parse(gameObject);
			//Writes game object to page
			var winner = -1;
			for (var i = 0; i<Object.keys(namesArray).length; i++)
			{
				namesArray[Object.keys(namesArray)[i]] = gameObject[Object.keys(namesArray)[i]];
				if (namesArray[Object.keys(namesArray)[i]] == trackLength-1)
					winner=i;
			}
			drawNames();
			renderBoard();
			if (winner != -1)
				showResults(winner);
		}
		function fakeData()
		{
			var data = {};
			for (var i = 0; i<Object.keys(namesArray).length; i++)
				data[Object.keys(namesArray)[i]] = namesArray[Object.keys(namesArray)[i]];
			var rnd = Math.floor(Math.random()*Object.keys(namesArray).length);
			data[Object.keys(data)[rnd]]++;
			receiveData(JSON.stringify(data));
		}
		
		function renderBoard()
		{
		   
			var grid = document.getElementById('gameBoard');
			grid.innerHTML = "";
			
			//now construct our table
			//for now hardcode it to be 8 rows and n columns
				// Object.keys(namesArray).length is n
			//horse position determined by 8-m where m is value associated with player
			          	 
		   			   
			for (var i = 0; i < 8; i++)
				grid.innerHTML += "<col width= '30px'>";
			grid.innerHTML += "<tbody id='tableBody'></tbody>";
			var gridTest = document.getElementById("tableBody");
			var html = "";
			
			html += "<tr><td class='border' colspan='" + Object.keys(namesArray).length + "'>";
			for( var k = 0; k < Object.keys(namesArray).length ; k++)
				html += "------";
			html += "</td></tr>";
			
			gridTest.innerHTML += html;  
			for (var i = 0; i < 8; i++)
			{
				gridTest.innerHTML += "<tr>";
				html = "";
				for (var j = 0; j < Object.keys(namesArray).length; j++)
				{
					if (namesArray[Object.keys(namesArray)[j]] == 7-i)
					{
						html += "<td>";
						html +=  "|  <a class='hasPlayer'>" + (j+1) + "</a>|" ;
					}
					else
					{
						html += "<td>";
						html += "| . |";
					}
					html += "</td>";
				}
				gridTest.innerHTML += html + "</tr>";
			}
			html = "";
			html += "<tr><td class='border' colspan='" + Object.keys(namesArray).length + "'>";
			for( var k = 0; k < Object.keys(namesArray).length ; k++)
				html += "------";
			html += "</td></tr>";
			gridTest.innerHTML += html; 
				
	          
			return;
		}
		
		function addName ()
		{
		
			var name = document.getElementById('nameInputBox');
			if (Object.keys(namesArray).length>=6)
			{
				alert("Sorry, this game has a max of 6 players.");
			}
			else if (namesArray[name.value] == 0)
			{
				alert("Sorry, no duplicate names allowed");
			}
			else
			{
				namesArray[name.value]=0;
				name.value = "";
				drawNames();
			}
			
			//TODO: SEND LIST OF NAMES TO SERVER
			//JSON.stringify(namesArray);
		}
		
		function drawNames()
		{
			var namesList = document.getElementById('namesList');
			namesList.innerHTML = "";
			for (var i = 0; i<Object.keys(namesArray).length; i++)
				namesList.innerHTML += "<li>" + Object.keys(namesArray)[i] + "</li>";	
			
		}
		
		function startGame()
		{
			if (Object.keys(namesArray).length <=1)
			{
				alert("Need at least two players to play!");
				exit;
			}
			document.getElementById('init').hidden=true;
			document.getElementById('game').hidden=false;
			renderBoard();
			
			//send list of all player objects to server
			//alert(JSON.stringify(namesArray));
			
		}
		
		function showResults(winnerVal)
		{
			document.getElementById('game').hidden=true;
			document.getElementById('results').hidden=false;
			document.getElementById('winner').innerHTML = "Winner was: <a id='winningPlayer'>" + Object.keys(namesArray)[winnerVal] + "</a>";
		}
		
		</SCRIPT>
	</HEAD>
	<BODY>
		<div id="init">
			Enter your Name: <input type="text" id='nameInputBox' onkeydown="if (event.keyCode == 13) addName()" />
			<br />
			<input type="button"class="add" value ="Add Name" onclick="addName()"/>
			<input type="button" class="button" value="Start Game" onclick="startGame()"/>
		</div>
		<div id="game">
			<table id="gameBoard" border="0">
			</table>
			<input type="button" class="button" value="increment" onclick="fakeData()"/>
		</div>
		<div id="results">
			<p id="winner"></p>
			<input type="button" class="end" value="New Game" onclick="init()"/>
			<br /> <br />
		</div>
		<div id="players">Players:
			<ol id="namesList"></ol>
		</div>
		<!-- quick script call to init -->
		<script type="text/javascript">init();</script>
	</BODY>
</HTML>